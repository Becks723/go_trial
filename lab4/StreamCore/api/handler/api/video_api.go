// Code generated by hertz generator.

package api

import (
	api "StreamCore/api/model/video"
	"StreamCore/api/pack"
	"StreamCore/api/rpc"
	"StreamCore/kitex_gen/video"
	"context"

	"github.com/cloudwego/hertz/pkg/app"
)

// Feed .
// @router /video/feed [GET]
func Feed(ctx context.Context, c *app.RequestContext) {
	var err error
	var req api.FeedQuery
	err = c.BindAndValidate(&req)
	if err != nil {
		pack.RespParamError(c, err)
		return
	}

	resp, err := rpc.FeedRPC(ctx, &video.FeedQuery{
		LatestTime: req.LatestTime,
	})
	if err != nil {
		pack.RespRPCError(c, err)
		return
	}

	if !pack.RespBizError(c, resp.Base) {
		pack.RespWithData(c, resp.Data)
	}
}

// Publish .
// @router /video/publish [POST]
func Publish(ctx context.Context, c *app.RequestContext) {
	var err error
	var req api.PublishReq
	err = c.BindAndValidate(&req)
	if err != nil {
		pack.RespParamError(c, err)
		return
	}

	resp, err := rpc.PublishRPC(ctx, &video.PublishReq{
		Data:        req.Data,
		Title:       req.Title,
		Description: req.Description,
		CoverData:   req.CoverData,
	})
	if err != nil {
		pack.RespRPCError(c, err)
		return
	}

	if !pack.RespBizError(c, resp.Base) {
		pack.RespSuccess(c)
	}
}

// List .
// @router /video/list [GET]
func List(ctx context.Context, c *app.RequestContext) {
	var err error
	var req api.ListQuery
	err = c.BindAndValidate(&req)
	if err != nil {
		pack.RespParamError(c, err)
		return
	}

	resp, err := rpc.ListRPC(ctx, &video.ListQuery{
		UserId:   req.UserID,
		PageNum:  req.PageNum,
		PageSize: req.PageSize,
	})
	if err != nil {
		pack.RespRPCError(c, err)
		return
	}

	if !pack.RespBizError(c, resp.Base) {
		pack.RespWithData(c, resp.Data)
	}
}

// Popular .
// @router /video/popular [GET]
func Popular(ctx context.Context, c *app.RequestContext) {
	var err error
	var req api.PopularQuery
	err = c.BindAndValidate(&req)
	if err != nil {
		pack.RespParamError(c, err)
		return
	}

	resp, err := rpc.PopularRPC(ctx, &video.PopularQuery{
		PageNum:  req.PageNum,
		PageSize: req.PageSize,
	})
	if err != nil {
		pack.RespRPCError(c, err)
		return
	}

	if !pack.RespBizError(c, resp.Base) {
		pack.RespWithData(c, resp.Data)
	}
}

// Search .
// @router /video/search [POST]
func Search(ctx context.Context, c *app.RequestContext) {
	var err error
	var req api.SearchReq
	err = c.BindAndValidate(&req)
	if err != nil {
		pack.RespParamError(c, err)
		return
	}

	resp, err := rpc.SearchRPC(ctx, &video.SearchReq{
		Keywords: req.Keywords,
		PageNum:  req.PageNum,
		PageSize: req.PageSize,
		FromDate: req.FromDate,
		ToDate:   req.ToDate,
		Username: req.Username,
	})
	if err != nil {
		pack.RespRPCError(c, err)
		return
	}

	if !pack.RespBizError(c, resp.Base) {
		pack.RespWithData(c, resp.Data)
	}
}

// Visit .
// @router /video/:vid [GET]
func Visit(ctx context.Context, c *app.RequestContext) {
	var err error
	var req api.VisitQuery
	err = c.BindAndValidate(&req)
	if err != nil {
		pack.RespParamError(c, err)
		return
	}

	resp, err := rpc.VisitRPC(ctx, &video.VisitQuery{
		VideoId: req.VideoID,
	})
	if err != nil {
		pack.RespRPCError(c, err)
		return
	}

	if !pack.RespBizError(c, resp.Base) {
		pack.RespWithData(c, resp.Data)
	}
}
